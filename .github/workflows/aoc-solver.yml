name: AoC Solver

on:
  schedule:
    # Run at 12:00 AM EST daily in December (5:00 AM UTC)
    - cron: "0 5 * 12 *"

  workflow_dispatch:
    inputs:
      year:
        description: "Year"
        required: true
        type: number
        default: 2025
      day:
        description: "Day to solve (1-25)"
        required: true
        type: number

run-name: "AoC ${{ inputs.year || '2025' }} ${{ inputs.day && format('Day {0}', inputs.day) || 'Daily Run' }}"

permissions:
  contents: write

jobs:
  solve:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Determine day and year
        id: set_day
        run: |
          if [ -n "${{ inputs.day }}" ]; then
            DAY="${{ inputs.day }}"
            YEAR="${{ inputs.year }}"
          else
            DAY=$(date +%-d)
            YEAR=$(date +%Y)
          fi

          # AoC only has 25 days, exit if day > 25
          if [ "$DAY" -gt 25 ]; then
            echo "Day $DAY is beyond AoC range (1-25), exiting"
            exit 0
          fi

          echo "day=$DAY" >> $GITHUB_OUTPUT
          echo "year=$YEAR" >> $GITHUB_OUTPUT
          echo "ðŸŽ„ Solving AoC $YEAR Day $DAY"

      - name: Solve with Claude
        id: claude
        env:
          AOC_SESSION: ${{ secrets.AOC_SESSION_COOKIE }}
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            Solve Advent of Code ${{ steps.set_day.outputs.year }} Day ${{ steps.set_day.outputs.day }}.

            Follow the "Daily Automation Instructions" in CLAUDE.md (already present in the repository root). The key environment variables are:
            YEAR=${{ steps.set_day.outputs.year }}
            DAY=${{ steps.set_day.outputs.day }}
            AOC_SESSION=${{ secrets.AOC_SESSION_COOKIE }}

            After each correct answer submission (Part 1 and Part 2), immediately:
            - `git add -A`
            - commit and push before moving on to the next part

            Use only the allowed tools and keep commits/pushes in sync with these instructions.
          claude_args: >-
            --allowedTools Read,Write,Edit,Bash,Glob,Grep
            --max-turns 50
            --model claude-opus-4-5-20251101
